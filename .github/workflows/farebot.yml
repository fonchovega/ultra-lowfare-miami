# ============================================================
# farebot.yml — Workflow principal del proyecto "Ultra-LowFare"
# ============================================================
# Centraliza la ejecución de búsqueda, sincronización e histórico.
# Autor: Víctor Alfonso Vega Huertas
# Fecha: Oct 2025
# ------------------------------------------------------------

name: run-farebot

on:
  workflow_dispatch:
  schedule:
    # Ejecutar automáticamente dos veces al día (03:00 y 15:00 UTC)
    - cron: "0 3,15 * * *"

jobs:
  run-farebot:
    runs-on: ubuntu-latest
    steps:
      # ------------------------------------------------------------
      # 1. Checkout del repositorio
      # ------------------------------------------------------------
      - name: Checkout
        uses: actions/checkout@v4

      # ------------------------------------------------------------
      # 2. Configurar Node.js
      # ------------------------------------------------------------
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20.x

      # ------------------------------------------------------------
      # 3. Instalar dependencias (si existen)
      # ------------------------------------------------------------
      - name: Install deps (si existen)
        run: |
          if [ -f "package.json" ]; then
            npm ci || npm install
          else
            echo "No hay package.json, saltando instalación."
          fi

      # ------------------------------------------------------------
      # 4. Preparar carpetas necesarias
      # ------------------------------------------------------------
      - name: Preparar carpetas
        run: |
          mkdir -p data logs outputs
          echo "Carpetas listas."

      # ------------------------------------------------------------
      # 5. Ejecutar script principal
      # ------------------------------------------------------------
      - name: Ejecutar sync_all.js
        run: |
          node scripts/sync_all.js

      # ------------------------------------------------------------
      # 6. Publicar artefactos de salida
      # ------------------------------------------------------------
      - name: Publicar artefactos
        uses: actions/upload-artifact@v4
        with:
          name: ultra-lowfare-data
          path: |
            data/
            logs/
            outputs/

      # ------------------------------------------------------------
      # 7. Log final
      # ------------------------------------------------------------
      - name: Finalizar
        run: echo "✅ Workflow FareBot completado correctamente."